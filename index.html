<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ursinho Amig√£o 3D - Fase 1</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #aee1f9;
      font-family: sans-serif;
    }

    #personagemSelecao {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .personagem-opcoes {
      display: flex;
      gap: 30px;
      margin-top: 20px;
    }

    .personagem {
      width: 100px;
      height: 100px;
      background-color: #fff;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: #333;
      font-weight: bold;
    }

    .personagem:hover {
      background-color: #ffd54f;
    }

    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0,0,0,0.6);
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
    }

    #direcional {
      position: absolute;
      bottom: 20px;
      left: 20px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .linha {
      display: flex;
      justify-content: center;
      gap: 5px;
    }

    .botao-direcional, #botao-acao {
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.7);
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 18px;
    }

    #botao-acao {
      position: absolute;
      bottom: 30px;
      right: 20px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="personagemSelecao">
    <h2>Escolha seu personagem</h2>
    <div class="personagem-opcoes">
      <div class="personagem" onclick="selecionar('urso')" style="background:#f4c542;">üêª<br>Urso</div>
      <div class="personagem" onclick="selecionar('gato')" style="background:#8bc34a;">üê±<br>Gato</div>
      <div class="personagem" onclick="selecionar('girafa')" style="background:#ffb74d;">ü¶í<br>Girafa</div>
      <div class="personagem" onclick="selecionar('coelho')" style="background:#e91e63;">üê∞<br>Coelha</div>
    </div>
  </div>

  <div id="hud">
    ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è<br>
    Itens certos: <span id="acertos">0</span> / 3<br>
    Tempo: <span id="tempo">90</span>s
  </div>

  <div id="direcional">
    <div class="linha"><button class="botao-direcional" ontouchstart="tecla('w',true)" ontouchend="tecla('w',false)">‚ñ≤</button></div>
    <div class="linha">
      <button class="botao-direcional" ontouchstart="tecla('a',true)" ontouchend="tecla('a',false)">‚óÑ</button>
      <button class="botao-direcional" ontouchstart="tecla('s',true)" ontouchend="tecla('s',false)">‚ñº</button>
      <button class="botao-direcional" ontouchstart="tecla('d',true)" ontouchend="tecla('d',false)">‚ñ∫</button>
    </div>
  </div>

  <button id="botao-acao" ontouchstart="coletando=true" ontouchend="coletando=false">üéí</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r148/three.min.js"></script>
  <script>
    let cena, camera, render, jogador;
    let teclas = {};
    let itens = [], errados = [];
    let acertos = 0, vidas = 3, tempo = 90;
    let coletando = false, bloqueado = false;

    document.addEventListener("keydown", e => {
      teclas[e.key.toLowerCase()] = true;
      if (e.code === "Space") coletando = true;
    });

    document.addEventListener("keyup", e => {
      teclas[e.key.toLowerCase()] = false;
      if (e.code === "Space") coletando = false;
    });

    function tecla(k, v) { teclas[k] = v; }

    function selecionar(tipo) {
      document.getElementById("personagemSelecao").remove();
      iniciar(tipo);
    }

    function iniciar(tipo) {
      cena = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      render = new THREE.WebGLRenderer();
      render.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(render.domElement);

      const luz = new THREE.HemisphereLight(0xffffff, 0x444444);
      cena.add(luz);

      // Terreno
      const chaoGeo = new THREE.BoxGeometry(60, 1, 60);
      const chaoMat = new THREE.MeshLambertMaterial({ color: 0x4caf50 });
      const chao = new THREE.Mesh(chaoGeo, chaoMat);
      chao.position.y = -0.5;
      cena.add(chao);

      // Paredes invis√≠veis (delimita√ß√£o)
      const paredeMat = new THREE.MeshBasicMaterial({ visible: false });
      const borda = new THREE.BoxGeometry(1, 10, 60);
      let b1 = new THREE.Mesh(borda, paredeMat);
      b1.position.set(-30.5, 5, 0);
      let b2 = new THREE.Mesh(borda, paredeMat);
      b2.position.set(30.5, 5, 0);
      let b3 = new THREE.Mesh(new THREE.BoxGeometry(60, 10, 1), paredeMat);
      b3.position.set(0, 5, -30.5);
      let b4 = new THREE.Mesh(new THREE.BoxGeometry(60, 10, 1), paredeMat);
      b4.position.set(0, 5, 30.5);
      cena.add(b1, b2, b3, b4);

      // Cores por personagem
      const cores = {
        urso: 0xffc107,
        gato: 0x8bc34a,
        coelho: 0xe91e63,
        girafa: 0xffb74d
      };

      const geo = new THREE.BoxGeometry(1, 1.3, 1);
      const mat = new THREE.MeshLambertMaterial({ color: cores[tipo] || 0xffffff });
      jogador = new THREE.Mesh(geo, mat);
      jogador.position.set(0, 0.65, 0);
      cena.add(jogador);

      camera.position.set(3, 3, 5);
      camera.lookAt(jogador.position);

      // Itens certos (brancos)
      for (let i = 0; i < 3; i++) {
        const item = new THREE.Mesh(
          new THREE.BoxGeometry(0.6, 0.6, 0.6),
          new THREE.MeshLambertMaterial({ color: 0xffffff })
        );
        item.position.set(Math.random() * 40 - 20, 0.3, Math.random() * 40 - 20);
        cena.add(item);
        itens.push(item);
      }

      // Itens errados (pretos)
      for (let i = 0; i < 5; i++) {
        const errado = new THREE.Mesh(
          new THREE.BoxGeometry(0.6, 0.6, 0.6),
          new THREE.MeshLambertMaterial({ color: 0x111111 })
        );
        errado.position.set(Math.random() * 40 - 20, 0.3, Math.random() * 40 - 20);
        cena.add(errado);
        errados.push(errado);
      }

      // Iniciar tempo
      setInterval(() => {
        if (tempo > 0) {
          tempo--;
          document.getElementById("tempo").innerText = tempo;
          if (tempo === 0) encerrar("‚è±Ô∏è Tempo esgotado!");
        }
      }, 1000);

      animar();
    }

    function coletar() {
      if (bloqueado) return;
      bloqueado = true;

      // Coleta item certo
      for (let i = 0; i < itens.length; i++) {
        if (jogador.position.distanceTo(itens[i].position) < 1) {
          cena.remove(itens[i]);
          itens.splice(i, 1);
          acertos++;
          document.getElementById("acertos").innerText = acertos;
          if (acertos >= 3) encerrar("‚úÖ Vit√≥ria!");
          setTimeout(() => bloqueado = false, 400);
          return;
        }
      }

      // Coleta item errado
      for (let i = 0; i < errados.length; i++) {
        if (jogador.position.distanceTo(errados[i].position) < 1) {
          cena.remove(errados[i]);
          errados.splice(i, 1);
          vidas--;
          atualizarHUD();
          if (vidas <= 0) encerrar("‚ùå Fim de jogo!");
          setTimeout(() => bloqueado = false, 400);
          return;
        }
      }

      setTimeout(() => bloqueado = false, 400);
    }

    function atualizarHUD() {
      let coracao = "‚ù§Ô∏è".repeat(vidas);
      document.getElementById("hud").innerHTML = `
        ${coracao}<br>
        Itens certos: <span id="acertos">${acertos}</span> / 3<br>
        Tempo: <span id="tempo">${tempo}</span>s
      `;
    }

    function encerrar(msg) {
      alert(msg);
      location.reload();
    }

    function animar() {
      requestAnimationFrame(animar);

      const vel = 0.15;
      if (teclas["w"]) jogador.position.z -= vel;
      if (teclas["s"]) jogador.position.z += vel;
      if (teclas["a"]) jogador.position.x -= vel;
      if (teclas["d"]) jogador.position.x += vel;

      // C√¢mera segue
      camera.position.x = jogador.position.x + 3;
      camera.position.z = jogador.position.z + 5;
      camera.lookAt(jogador.position);

      if (coletando) coletar();

      render.render(cena, camera);
    }
  </script>
</body>
</html>
