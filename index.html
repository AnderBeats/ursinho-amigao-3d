<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ursinho Amig√£o 2D - Aventura de Aprendizados</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #aee1f9; /* Fundo azul claro */
            font-family: 'Inter', sans-serif; /* Usando a fonte Inter */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Garante que o corpo ocupa a altura total da viewport */
            position: relative; /* Para posicionamento absoluto dos elementos */
        }
        #introScreen {
            position: absolute;
            inset: 0;
            background: #aee1f9; /* Fundo azul claro para a tela de introdu√ß√£o */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20; /* Acima de tudo, exceto modais */
            color: #333;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            cursor: pointer; /* Adicionado para indicar que a tela √© clic√°vel */
        }
        #introImagePlaceholder { /* New style for the image placeholder */
            width: 400px;
            height: 300px;
            background-color: #ffd54f; /* Yellowish background */
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8em; /* Increased font size for the emoji */
            color: #333;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        #introScreen h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            display: flex; /* Use flexbox for centering children */
            flex-direction: column; /* Stack children vertically */
            align-items: center; /* Center horizontally */
            text-align: center; /* Ensure text within spans is centered */
        }
        #introScreen h1 span {
            display: block; /* Ensure spans take full width for line break */
        }
        #introScreen p {
            font-size: 1.5em;
            font-weight: bold;
            color: #34495e;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        #personagemSelecao {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: none; /* Changed from none to flex to ensure it's visible initially */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .personagem-opcoes {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap; /* Permite quebrar linha em telas menores */
            justify-content: center;
        }
        .personagem {
            width: 100px;
            height: 100px;
            background-color: #fff;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #333;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* Sombra suave */
            transition: transform 0.2s, background-color 0.2s; /* Transi√ß√£o suave */
            text-align: center; /* Adicionado para centralizar o texto dentro da caixinha */
            font-size: 3em; /* Ajustado o tamanho do emoji para caber na caixa */
        }
        .personagem:hover {
            background-color: #ffd54f; /* Amarelo ao passar o mouse */
            transform: translateY(-5px); /* Efeito de eleva√ß√£o ao passar o mouse */
        }
        .personagem span { /* Estilo para o nome do personagem */
            font-size: 0.3em; /* Reduz o tamanho da fonte para o nome */
            display: block; /* Garante que o nome fique em uma nova linha */
            margin-top: 0.2em; /* Ajusta a margem para aproximar o nome do emoji e subir o emoji */
        }
        #hud {
            position: absolute;
            top: 80px; /* Adjusted top for desktop */
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 8px;
            z-index: 10;
            font-size: 1.1em;
            display: none; /* Oculta o HUD por padr√£o */
            flex-direction: row; /* Use flexbox for columns */
            justify-content: space-between; /* Distribute space between columns */
            width: 90%; /* Occupy most of the width */
            max-width: 700px; /* Limit max width */
            box-sizing: border-box; /* Include padding in width */
            align-items: flex-start; /* Align columns to the top */
        }
        .hud-column {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Align text to the left within each column */
            flex-basis: 48%; /* Give columns a basis to distribute space */
            padding: 0 5px; /* Reduced internal padding for better fit */
            box-sizing: border-box; /* Include padding in width */
            background: rgba(255,255,255,0.2); /* Light background for the "box" effect - Adjusted to 0.2 */
            border-radius: 5px;
        }
        .hud-column:last-child {
            align-items: flex-end; /* Align right column text to the right */
        }
        #objetivoFase {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 8px;
            z-index: 10;
            font-size: 1.1em;
            text-align: right;
            display: none; /* Adicionado para ocultar o painel de objetivo da fase */
        }
        /* Controles posicionados sobre o canvas */
        #direcional {
            position: fixed; /* Fixado na viewport */
            bottom: 20px;
            left: 20px; /* Canto inferior esquerdo */
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .linha {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .botao-direcional, .botao-jogo { /* Classe geral para bot√µes de jogo */
            width: 50px; /* Bot√µes ligeiramente maiores */
            height: 50px;
            background: rgba(255,255,255,0.3); /* Transpar√™ncia */
            border: none;
            border-radius: 12px; /* Cantos mais arredondados */
            font-weight: bold;
            font-size: 24px; /* Fonte maior para √≠cones */
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            transition: background 0.2s, transform 0.1s;
            z-index: 10; /* Ensure buttons are above canvas */
        }
        .botao-direcional:active, .botao-jogo:active {
            background: rgba(255,255,255,0.5); /* Menos transparente ao clicar */
            transform: translateY(2px); /* Efeito de clique */
        }
        #botao-acao {
            position: fixed; /* Fixado na viewport */
            bottom: 30px;
            right: 20px; /* Canto inferior direito */
            z-index: 10;
            background: rgba(76, 175, 80, 0.3); /* Verde com transpar√™ncia */
            color: white;
            border-radius: 50%; /* Torna o bot√£o redondo */
            display: flex; /* Para centralizar o conte√∫do */
            align-items: center; /* Para centralizar o conte√∫do */
            justify-content: center; /* Para centralizar o conte√∫do */
            font-size: 30px; /* Ajusta o tamanho da fonte para o 'A' */
        }

        /* Estilo do Canvas 2D */
        canvas {
            background-color: #8bc34a; /* Cor do ch√£o para 2D */
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            display: block; /* Remove espa√ßo extra abaixo do canvas */
            width: 80vw; /* Reduced from 90% */
            height: 70vh; /* Reduced from 80vh */
            max-width: 700px; /* Keep a reasonable max size for desktop */
            max-height: 500px; /* Keep a reasonable max size for desktop */
            margin: 20px auto; /* Centraliza o canvas */
        }

        /* Mensagem de dica LLM */
        #llmHintMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            z-index: 15;
            display: none; /* Oculto por padr√£o */
            max-width: 70%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: fadeIn 0.3s forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Novo Modal de Continue */
        #continueModal {
            display: none; /* Oculto por padr√£o */
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            flex-direction: column; /* Changed to flex for centering */
            align-items: center;
            justify-content: center;
            z-index: 30; /* Acima de outros modais */
            text-align: center;
        }
        #continueModal h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        #continueModal p {
            font-size: 1.8em;
            margin-bottom: 30px;
        }
        #continueModal .botoes-continue {
            display: flex;
            gap: 20px;
        }
        #continueModal .botoes-continue button {
            padding: 15px 30px;
            font-size: 1.5em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        #continueModal .botoes-continue button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        #continueModal #btnSim {
            background-color: #4CAF50;
            color: white;
        }
        #continueModal #btnNao {
            background-color: #f44336;
            color: white;
        }
        #temporaryMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.5em;
            z-index: 25;
            display: none;
        }

        /* Estilo para o t√≠tulo do cap√≠tulo */
        #chapterTitleDisplay {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.2em;
            z-index: 10;
            text-align: center;
            white-space: nowrap; /* Evita quebra de linha */
        }

        /* Bot√£o de controle de som */
        #soundControlBtn {
            position: fixed;
            bottom: 20px; /* Ajuste conforme necess√°rio para n√£o colidir com outros bot√µes */
            left: 50%;
            transform: translateX(-50%);
            width: 60px; /* Tamanho do bot√£o */
            height: 60px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%; /* Redondo */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px; /* Tamanho do √≠cone */
            color: white;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s, transform 0.1s;
        }
        #soundControlBtn:active {
            background: rgba(255, 255, 255, 0.5);
            transform: translateX(-50%) translateY(2px);
        }
        #soundControlBtn svg {
            width: 30px; /* Tamanho do SVG */
            height: 30px;
        }


        /* Media Queries for Mobile Adjustments */
        @media (max-width: 768px) {
            #introImagePlaceholder {
                width: 80vw;
                height: 40vh;
                font-size: 6em;
            }
            #introScreen h1 {
                font-size: 1.8em;
            }
            #introScreen p {
                font-size: 1.2em;
            }
            #hud {
                font-size: 0.9em;
                padding: 8px;
                top: 70px; /* Adjusted top for mobile */
                flex-direction: row; /* Keep columns side-by-side if enough space */
            }
            .hud-column {
                align-items: flex-start; /* Default for both columns */
            }
            .hud-column:last-child {
                align-items: flex-end; /* Keep right column aligned right */
            }
            .botao-direcional, .botao-jogo {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            #botao-acao {
                width: 60px;
                height: 60px;
                font-size: 26px;
            }
            #direcional {
                bottom: 10px;
                left: 10px;
            }
            #botao-acao {
                bottom: 20px;
                right: 10px;
            }
            /* Removed gameModal related styles as it's no longer used */
            #continueModal h2 {
                font-size: 2em;
            }
            #continueModal p {
                font-size: 1.5em;
            }
            #continueModal .botoes-continue button {
                padding: 12px 25px;
                font-size: 1.2em;
            }
            canvas {
                width: 90vw; /* Slightly larger on tablet to fill space */
                height: 75vh; /* Slightly larger */
            }
        }

        @media (max-width: 360px) { /* Adjusted breakpoint for stacking columns on very small screens */
            #hud {
                top: 40px; /* Further adjust top for very small screens */
                font-size: 0.75em; /* Smaller font for very small screens */
                flex-direction: column; /* Stack columns vertically on very small screens */
                align-items: center; /* Center stacked columns */
            }
            .hud-column:last-child {
                align-items: center; /* Center text when stacked */
            }
            #introScreen h1 {
                font-size: 1.3em;
            }
            #introScreen p {
                font-size: 0.9em;
            }
            .botao-direcional, .botao-jogo {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            #botao-acao {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }
            #direcional {
                bottom: 2px;
                left: 2px;
            }
            #botao-acao {
                bottom: 10px;
                right: 2px;
            }
            canvas {
                width: 95vw; /* Maximize on very small screens */
                height: 65vh; /* Adjust height */
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Introdu√ß√£o -->
    <div id="introScreen">
        <div id="introImagePlaceholder">
            üêª
        </div>
        <h1>
            <span>Ursinho Amig√£o e Seus Amigos em:</span><br>
            <span>Meu Dia na Escola - Parte I</span>
        </h1>
        <p>Pressione qualquer bot√£o para come√ßar</p>
    </div>

    <!-- Tela de Sele√ß√£o de Personagem -->
    <div id="personagemSelecao">
        <h2>Escolha seu personagem</h2>
        <div class="personagem-opcoes">
            <div class="personagem" id="personagemUrso" style="background:#f4c542;">üêª<br><span>URSINHO<br>AMIG√ÉO</span></div>
            <div class="personagem" id="personagemGato" style="background:#8bc34a;">üê±<br><span>GATINHO<br>TITO</span></div>
            <div class="personagem" id="personagemGirafa" style="background:#ffb74d;">ü¶í<br><span>GIRAFINHA<br>GINA</span></div>
            <div class="personagem" id="personagemCoelho" style="background:#e91e63;">üê∞<br><span>COELHINHA<br>LILI</span></div>
        </div>
    </div>

    <!-- Heads-Up Display (HUD) -->
    <div id="hud">
        <div class="hud-column">
            <span id="vidasDisplay"></span>
            <span id="totalAllItemsCollectedDisplay"></span>
            <span id="tempo"></span>
        </div>
        <div class="hud-column">
            <span id="hudObjectiveLine1"></span>
            <span id="hudObjectiveLine2"></span>
        </div>
    </div>

    <!-- T√≠tulo do Cap√≠tulo Centralizado -->
    <div id="chapterTitleDisplay"></div>

    <!-- Painel de Objetivo da Fase (canto superior direito) -->
    <div id="objetivoFase" style="display: none;"></div>

    <!-- Canvas para o jogo 2D -->
    <canvas id="gameCanvas" tabindex="0"></canvas>

    <!-- Controles Direcionais para Celular -->
    <div id="direcional">
        <div class="linha">
            <button class="botao-direcional" id="btnUp">‚ñ≤</button>
        </div>
        <div class="linha">
            <button class="botao-direcional" id="btnLeft">‚óÑ</button>
            <button class="botao-direcional" id="btnDown">‚ñº</button>
            <button class="botao-direcional" id="btnRight">‚ñ∫</button>
        </div>
    </div>

    <!-- Bot√£o de A√ß√£o para Celular -->
    <button id="botao-acao" class="botao-jogo">A</button>

    <!-- Bot√£o de controle de som -->
    <button id="soundControlBtn" class="botao-jogo">
        <svg id="soundOnIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        <svg id="soundOffIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-x" style="display: none;"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
    </button>

    <!-- Mensagem de Dica LLM -->
    <div id="llmHintMessage" style="display: none;">
        Aguarde a dica...
    </div>

    <!-- Mensagem Tempor√°ria (ex: "Vida perdida!") -->
    <div id="temporaryMessage" style="display: none;"></div>

    <!-- Modal de Fim de Jogo/Vit√≥ria -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <p id="modalMessage"></p>
            <button onclick="location.reload()">Jogar Novamente</button>
        </div>
    </div>

    <!-- Tags de √°udio para as trilhas sonoras -->
    <audio id="introMusic" src="https://raw.githack.com/AnderBeats/ursinho-amigao-3d/main/Ursinho%20Trilha/Abertura_Fim.mp3" preload="auto" loop></audio>
    <!-- Removida a tag de m√∫sica de fase, pois apenas a m√∫sica de introdu√ß√£o ser√° utilizada por enquanto. -->

    <!-- Script principal do jogo -->
    <script>
        // Centraliza a l√≥gica do jogo em um objeto global para melhor organiza√ß√£o e evitar problemas de escopo.
        const game = {
            canvas: null,
            ctx: null,
            player: null,
            teclas: {}, // Armazena o estado das teclas pressionadas
            itens: [], // Array para todos os itens do tesouro (colet√°veis)
            obstaculos: [], // Array para os obst√°culos que bloqueiam o caminho
            schoolItems: [], // Novos itens escolares que n√£o s√£o colet√°veis nem obst√°culos
            chest: null, // O ba√∫ do tesouro
            pedrasColetadas: 0, // Contagem de pedras coletadas
            TOTAL_PEDRAS: 3, // Total de pedras necess√°rias
            keysColetadas: 0, // Novo: Contagem de chaves coletadas
            TOTAL_CHAVES: 3, // Novo: Total de chaves necess√°rias para a Fase 1

            valesSorveteColetados: 0, // Novo: Contagem de vales sorvete coletados
            TOTAL_VALES_SORVETE: 4, // Novo: Total de vales sorvete necess√°rios para a Fase 2
            sorvetesObjetivoColetados: 0, // Novo: Contagem de sorvetes objetivo coletados
            TOTAL_SORVETES_OBJETIVO: 4, // Novo: Total de sorvetes objetivo necess√°rios para a Fase 2
            trofeusColetados: 0, // Novo: Contagem de trof√©us coletados para a Fase 3
            TOTAL_TROFEUS: 3, // Novo: Total de trof√©us necess√°rios para a Fase 3
            bolasColetadas: 0, // Novo: Contagem de bolas coletadas para a Fase 3
            TOTAL_BOLAS_FASE3: 3, // Novo: Total de bolas necess√°rias para a Fase 3
            pipasColetadas: 0, // Novo: Contagem de pipas coletadas para a Fase 3
            TOTAL_PIPAS: 3, // Novo: Total de pipas necess√°rias para a Fase 3

            tubosEnsaioColetados: 0, // Novo: Contagem de tubos de ensaio coletados para a Fase 4
            TOTAL_TUBOS_ENSAIO: 3, // Novo: Total de tubos de ensaio necess√°rios para a Fase 4
            imasColetados: 0, // Novo: Contagem de √≠m√£s coletados para a Fase 4
            TOTAL_IMAS: 3, // Novo: Total de √≠m√£s necess√°rios para a Fase 4
            microscopioColetados: 0, // Novo: Contagem de microsc√≥pios coletados para a Fase 4
            TOTAL_MICROSCOPIO: 3, // Novo: Total de microsc√≥pios necess√°rios para a Fase 4
            elefantesColetados: 0, // Novo: Contagem de elefantes coletados para a Fase 5
            TOTAL_ELEFANTES: 3, // Novo: Total de elefantes necess√°rios para a Fase 5
            leoesColetados: 0, // Novo: Contagem de le√µes coletados para a Fase 5
            TOTAL_LEOES: 3, // Novo: Total de le√µes necess√°rios para a Fase 5
            avesColetadas: 0, // Novo: Contagem de aves coletadas para a Fase 5
            TOTAL_AVES: 3, // Novo: Total de aves necess√°rias para a Fase 5
            pinturasColetadas: 0, // Novo: Contagem de pinturas coletadas para a Fase 6
            TOTAL_PINTURAS: 3, // Novo: Total de pinturas necess√°rias para a Fase 6
            esculturasColetadas: 0, // Novo: Contagem de esculturas coletadas para a Fase 6
            TOTAL_ESCULTURAS: 3, // Novo: Total de esculturas necess√°rias para a Fase 6
            fosseisColetados: 0, // Novo: Contagem de f√≥sseis coletados para a Fase 6
            TOTAL_FOSSEIS: 3, // Novo: Total de f√≥sseis necess√°rios para a Fase 6
            cestasPiqueniqueColetadas: 0, // Novo: Contagem de cestas de piquenique coletadas para a Fase 7
            TOTAL_CESTAS_PIQUENIQUE: 3, // Novo: Total de cestas de piquenique necess√°rias para a Fase 7
            bolasFase7Coletadas: 0, // Novo: Contagem de bolas coletadas para a Fase 7
            TOTAL_BOLAS_FASE7: 3, // Novo: Total de bolas necess√°rias para a Fase 7
            brinquedosParqueColetados: 0, // Novo: Contagem de brinquedos de parque coletados para a Fase 7
            TOTAL_BRINQUEDOS_PARQUE: 3, // Novo: Total de brinquedos de parque necess√°rios para a Fase 7

            // Novos contadores para os cap√≠tulos 8 a 12
            livroAventuraColetados: 0,
            TOTAL_LIVRO_AVENTURA: 3,
            livroAnimaisColetados: 0,
            TOTAL_LIVRO_ANIMAIS: 3,
            livroFabulaColetados: 0,
            TOTAL_LIVRO_FABULA: 3,

            lixeiraReciclagemColetados: 0,
            TOTAL_LIXEIRA_RECICLAGEM: 3,
            garrafaPlasticoColetados: 0,
            TOTAL_GARRAFA_PLASTICO: 3,
            arvoreMudaColetados: 0,
            TOTAL_ARVORE_MUDA: 3,

            plantaNativaColetados: 0,
            TOTAL_PLANTAS_NATIVAS: 3,
            animalSelvagemColetados: 0,
            TOTAL_ANIMAIS_SELVAGENS: 3,
            telescopioColetados: 0, // Renamed from binoculosColetados
            TOTAL_TELESCOPIO: 3, // Renamed from TOTAL_BINOCULOS

            pincelColetados: 0,
            TOTAL_PINCEL: 3,
            tintaColetados: 0,
            TOTAL_TINTA: 3,
            argilaColetados: 0,
            TOTAL_ARGILA: 3,

            violaoColetados: 0,
            TOTAL_VIOLAO: 3,
            pianoColetados: 0,
            TOTAL_PIANO: 3,
            microfoneColetados: 0,
            TOTAL_MICROFONE: 3,

            // Vari√°veis para o sistema de n√≠veis
            currentLevel: 1, // Come√ßa no N√≠vel 1
            BASE_TIME: 90, // Tempo base em segundos para o N√≠vel 1
            TIME_DECREMENT_PER_LEVEL: 10, // Decremento de tempo por n√≠vel

            totalAllItemsCollected: 0, // Nova vari√°vel para contar TODOS os itens coletados
            vidas: 3, // Vidas do jogador
            tempo: 0, // Tempo do jogo em segundos (inicializado em iniciar)
            coletando: false, // Flag para a√ß√£o de coleta (coletar item ou usar chave no ba√∫)
            gameInterval: null, // Para o temporador do jogo
            hintTimeout: null, // Para esconder a dica LLM
            hasKey: false, // Flag para verificar se a chave foi coletada
            continueCountdownInterval: null, // Intervalo para a contagem regressiva do continue
            continueTime: 10, // Tempo inicial da contagem regressiva do continue
            currentPlayerType: '', // Armazena o tipo de personagem selecionado para rein√≠cios
            currentPhase: 1, // Inicia na Fase 1

            PLAYER_SIZE: 45, // Tamanho do personagem (aumentado em 5px)
            ITEM_SIZE: 35, // Tamanho dos itens colet√°veis (aumentado em 5px)
            OBSTACLE_SIZE: 35, // Tamanho dos obst√°culos (aumentado em 5px)
            SCHOOL_ITEM_SIZE: 30, // Tamanho dos itens escolares n√£o colet√°veis (aumentado em 5px)
            CHEST_SIZE: 55, // Tamanho do ba√∫ (aumentado em 5px)
            PLAYER_SPEED: 3, // Velocidade do personagem (ajustada para m√©dio)

            // Vari√°veis para o limitador de FPS
            targetFPS: 30, // FPS alvo
            frameInterval: 0, // Intervalo de tempo entre frames em ms (calculado em initGame)
            lastFrameTime: 0, // Initialized globally

            // Global references to HUD elements (set in initGame)
            vidasDisplayElement: null,
            hudObjectiveLine1Element: null,
            hudObjectiveLine2Element: null,
            totalAllItemsCollectedDisplayElement: null,
            tempoDisplayElement: null,
            chapterTitleDisplayElement: null,
            objetivoFaseElement: null,
            
            // Vari√°veis de √°udio
            introMusicElement: null,
            currentMusic: null, // Para controlar a m√∫sica que est√° tocando atualmente

            // M√©todo para tocar uma m√∫sica, pausando a anterior se houver
            playMusic: function(musicElement) {
                // Se a m√∫sica atual n√£o √© a que queremos tocar ou se n√£o h√° m√∫sica tocando, ajusta.
                if (this.currentMusic !== musicElement) {
                    if (this.currentMusic) {
                        this.currentMusic.pause();
                        this.currentMusic.currentTime = 0; // Reinicia a m√∫sica para o come√ßo
                    }
                    this.currentMusic = musicElement;
                    if (this.currentMusic) {
                        this.currentMusic.play().catch(e => console.log("Erro ao tocar m√∫sica (pode precisar de intera√ß√£o do usu√°rio):", e));
                    }
                } else if (this.currentMusic && this.currentMusic.paused) {
                    // Se a mesma m√∫sica j√° est√° selecionada mas est√° pausada, tenta tocar.
                    this.currentMusic.play().catch(e => console.log("Erro ao retomar m√∫sica (pode precisar de intera√ß√£o do usu√°rio):", e));
                }
            },

            // M√©todo para parar toda a m√∫sica
            stopAllMusic: function() {
                if (this.currentMusic) {
                    this.currentMusic.pause();
                    this.currentMusic.currentTime = 0;
                    this.currentMusic = null;
                }
            },

            // M√©todo para atualizar o estado da tecla (para teclado e toque)
            tecla: function(k, v) {
                this.teclas[k] = v;
            },

            // M√©todo para redimensionar o canvas
            resizeCanvas: function() {
                if (!this.canvas) return; // Adicionado null check
                // Ajustado para um campo de jogo menor, ideal para celular
                this.canvas.width = window.innerWidth * 0.8; // 80% da largura da janela
                this.canvas.height = window.innerHeight * 0.7; // 70% da altura da viewport
                
                // Limites m√≠nimos e m√°ximos para o canvas
                this.canvas.width = Math.max(300, Math.min(700, this.canvas.width));
                this.canvas.height = Math.max(200, Math.min(500, this.canvas.height));

                // Reposiciona o jogador no centro se o canvas for redimensionado
                if (this.player) {
                    this.player.x = this.canvas.width / 2 - this.PLAYER_SIZE / 2;
                    this.player.y = this.canvas.height / 2 - this.PLAYER_SIZE / 2;
                }
            },

            // Retorna o emoji do personagem selecionado
            getCharacterEmoji: function(tipo) {
                switch (tipo) {
                    case 'urso': return 'üêª';
                    case 'gato': return 'üê±';
                    case 'girafa': return 'ü¶í';
                    case 'coelho': return 'üê∞';
                    default: return '‚ùì';
                }
            },

            // Cria um objeto de jogo (item, obst√°culo, ba√∫, item escolar)
            createGameObject: function(type, emoji, size, canBeCollected, isObstacle, color = null, isObjective = false) {
                return {
                    type: type,
                    emoji: emoji,
                    canBeCollected: canBeCollected, // Se pode ser coletado pelo bot√£o de a√ß√£o
                    isObstacle: isObstacle,      // Se bloqueia o caminho
                    color: color,
                    isObjective: isObjective,      // Se conta para o objetivo principal
                    x: 0, 
                    y: 0, 
                    size: size,
                    width: size, 
                    height: size 
                };
            },

            // Posiciona todos os objetos no canvas de forma aleat√≥ria, evitando sobreposi√ß√£o inicial
            placeGameObjectsRandomly: function() {
                const padding = 20; // Espa√ßamento das bordas do canvas
                const minX = padding;
                const minY = padding;
                const maxX = this.canvas.width - padding;
                const maxY = this.canvas.height - padding;

                const placedObjects = []; // Para controlar a sobreposi√ß√£o

                // Define uma √°rea segura no centro para o jogador (din√¢mica)
                const playerSafeZoneSize = this.PLAYER_SIZE + (4 * this.OBSTACLE_SIZE); // 2x OBSTACLE_SIZE em cada lado do player
                const playerSafeZone = {
                    x: this.canvas.width / 2 - playerSafeZoneSize / 2,
                    y: this.canvas.height / 2 - playerSafeZoneSize / 2,
                    width: playerSafeZoneSize,
                    height: playerSafeZoneSize
                };

                const getRandomPosition = (objSize, isObstacle = false) => {
                    let newX, newY, collision;
                    let attempts = 0;
                    const maxAttempts = 1000; // Aumentado para mais chances de posicionamento
                    // Define a dist√¢ncia m√≠nima de afastamento para objetos (3 vezes o tamanho de um obst√°culo)
                    const minClearanceBetweenObjects = 3 * this.OBSTACLE_SIZE; 

                    do {
                        collision = false;
                        newX = Math.random() * (maxX - minX - objSize) + minX;
                        newY = Math.random() * (maxY - minY - objSize) + minY;

                        const newRect = { x: newX, y: newY, width: objSize, height: objSize };

                        // Verifica colis√£o com objetos j√° posicionados
                        for (const placedObj of placedObjects) {
                            // Calcula a dist√¢ncia m√≠nima necess√°ria entre os centros dos objetos
                            const requiredMinDistanceX = (newRect.width / 2) + (placedObj.width / 2) + minClearanceBetweenObjects;
                            const requiredMinDistanceY = (newRect.height / 2) + (placedObj.height / 2) + minClearanceBetweenObjects;

                            // Verifica se os objetos est√£o muito pr√≥ximos
                            if (Math.abs(newRect.x + newRect.width / 2 - (placedObj.x + placedObj.width / 2)) < requiredMinDistanceX &&
                                Math.abs(newRect.y + newRect.height / 2 - (placedObj.y + placedObj.height / 2)) < requiredMinDistanceY) {
                                collision = true;
                                break;
                            }
                        }

                        // Se for um obst√°culo ou um item colet√°vel, verifica tamb√©m colis√£o com a zona segura do jogador
                        if (!collision && (isObstacle || newRect.canBeCollected) && this.checkCollision(newRect, playerSafeZone)) {
                            collision = true;
                        }

                        attempts++;
                    } while (collision && attempts < maxAttempts);

                    if (attempts === maxAttempts) {
                        console.warn(`AVISO: N√£o foi poss√≠vel encontrar uma posi√ß√£o livre para o objeto de tamanho ${objSize} ap√≥s ${maxAttempts} tentativas. Pode haver sobreposi√ß√£o.`);
                    }
                    return { x: newX, y: newY, width: objSize, height: objSize };
                };

                // Posicionar obst√°culos primeiro para garantir o espa√ßamento
                // 3 Cadeiras
                for (let i = 0; i < 3; i++) { 
                    this.obstaculos.push(this.createGameObject('cadeira', 'ü™ë', this.OBSTACLE_SIZE, false, true));
                }
                // 3 Mesas
                for (let i = 0; i < 3; i++) { 
                    this.obstaculos.push(this.createGameObject('mesa', 'ü™ë', this.OBSTACLE_SIZE, false, true));
                }
                // 3 Arm√°rios
                for (let i = 0; i < 3; i++) { 
                    this.obstaculos.push(this.createGameObject('armario', 'üö™', this.OBSTACLE_SIZE, false, true));
                }
                // 'quadro' removido conforme solicitado.

                this.obstaculos.forEach(obstacle => {
                    const pos = getRandomPosition(obstacle.size, true); // Passa true para isObstacle
                    obstacle.x = pos.x;
                    obstacle.y = pos.y;
                    placedObjects.push(obstacle);
                });

                // Posicionar o ba√∫ (apenas na Fase 1)
                if (this.chest && this.currentPhase === 1) {
                    const pos = getRandomPosition(this.chest.size);
                    this.chest.x = pos.x;
                    this.chest.y = pos.y;
                    placedObjects.push(this.chest);
                }

                // Posicionar itens
                this.itens.forEach(item => {
                    const pos = getRandomPosition(item.size);
                    item.x = pos.x;
                    item.y = pos.y;
                    placedObjects.push(item);
                });

                // Posicionar itens escolares
                this.schoolItems.forEach(sItem => {
                    const pos = getRandomPosition(sItem.size);
                    sItem.x = pos.x;
                    sItem.y = pos.y;
                    placedObjects.push(sItem);
                });
            },

            // Desenha um objeto no canvas
            drawItem: function(item) {
                if (!this.ctx) return; // Adicionado null check
                // Tenta usar uma lista de fontes de emoji para melhor compatibilidade
                this.ctx.font = `${item.size}px "Segoe UI Emoji", "Apple Color Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif`;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(item.emoji, item.x + item.size / 2, item.y + item.size / 2);
            },

            // Desenha o personagem no canvas
            drawPlayer: function() {
                if (!this.ctx) return; // Adicionado null check
                // Tenta usar uma lista de fontes de emoji para melhor compatibilidade
                this.ctx.font = `${this.player.width}px "Segoe UI Emoji", "Apple Color Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif`;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(this.player.emoji, this.player.x + this.player.width / 2, this.player.y + this.player.height / 2);
            },

            // Verifica colis√£o entre dois ret√¢ngulos (AABB)
            checkCollision: function(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            },

            // L√≥gica de intera√ß√µes (coleta de itens, colis√£o com obst√°culos, intera√ß√£o com o ba√∫)
            handleInteractions: function() {
                // Oculta qualquer dica LLM ativa ao interagir
                const hintMessageDiv = document.getElementById('llmHintMessage');
                if (hintMessageDiv) {
                    hintMessageDiv.style.display = 'none';
                }
                if (this.hintTimeout) clearTimeout(this.hintTimeout);

                // 1. Coleta de Itens (se o bot√£o de a√ß√£o estiver pressionado)
                if (this.coletando) {
                    // Percorre todos os itens para verificar coleta
                    for (let i = 0; i < this.itens.length; i++) {
                        if (this.itens[i].canBeCollected && this.checkCollision(this.player, this.itens[i])) {
                            const collectedItem = this.itens.splice(i, 1)[0];
                            this.totalAllItemsCollected++; // Incrementa a contagem total

                            if (collectedItem.isObjective) {
                                if (this.currentPhase === 1) { // L√≥gica de objetivo da Fase 1
                                    if (collectedItem.type === 'pedra') {
                                        this.pedrasColetadas++;
                                        console.log(`DEBUG: Pedra coletada! Total de pedras: ${this.pedrasColetadas}/${this.TOTAL_PEDRAS}`);
                                    } else if (collectedItem.type === 'chave') {
                                        this.keysColetadas++; // Incrementa o contador de chaves
                                        console.log(`DEBUG: Chave coletada! Total de chaves: ${this.keysColetadas}/${this.TOTAL_CHAVES}`); // Log para a nova l√≥gica de chaves
                                    }
                                } else if (this.currentPhase === 2) { // L√≥gica de objetivo da Fase 2
                                    if (collectedItem.type === 'vale_sorvete') {
                                        this.valesSorveteColetados++;
                                        console.log(`DEBUG: Vale Sorvete coletado! Total de vales: ${this.valesSorveteColetados}/${this.TOTAL_VALES_SORVETE}`);
                                    } else if (collectedItem.type === 'sorvete' && collectedItem.isObjective) { // Sorvetes objetivo na Fase 2
                                        this.sorvetesObjetivoColetados++;
                                        console.log(`DEBUG: Sorvete coletado! Total de sorvetes: ${this.sorvetesObjetivoColetados}/${this.TOTAL_SORVETES_OBJETIVO}`);
                                    }
                                } else if (this.currentPhase === 3) { // L√≥gica de objetivo da Fase 3
                                    if (collectedItem.type === 'trofeu') {
                                        this.trofeusColetados++;
                                        console.log(`DEBUG: Trof√©u coletado! Total de trof√©us: ${this.trofeusColetados}/${this.TOTAL_TROFEUS}`);
                                    } else if (collectedItem.type === 'bola' && collectedItem.isObjective) { // Bolas objetivo na Fase 3
                                        this.bolasColetadas++;
                                        console.log(`DEBUG: Bola coletada! Total de bolas: ${this.bolasColetadas}/${this.TOTAL_BOLAS_FASE3}`);
                                    } else if (collectedItem.type === 'pipa') { // Novo objetivo
                                        this.pipasColetadas++;
                                        console.log(`DEBUG: Pipa coletada! Total: ${this.pipasColetadas}/${this.TOTAL_PIPAS}`);
                                    }
                                } else if (this.currentPhase === 4) { // L√≥gica de objetivo da Fase 4
                                    if (collectedItem.type === 'tubo_ensaio') {
                                        this.tubosEnsaioColetados++;
                                        console.log(`DEBUG: Tubo de Ensaio coletado! Total: ${this.tubosEnsaioColetados}/${this.TOTAL_TUBOS_ENSAIO}`);
                                    } else if (collectedItem.type === 'ima') {
                                        this.imasColetados++;
                                        console.log(`DEBUG: √çm√£ coletado! Total: ${this.imasColetados}/${this.TOTAL_IMAS}`);
                                    } else if (collectedItem.type === 'microscopio') { // Novo objetivo
                                        this.microscopioColetados++;
                                        console.log(`DEBUG: Microsc√≥pio coletado! Total: ${this.microscopioColetados}/${this.TOTAL_MICROSCOPIO}`);
                                    }
                                } else if (this.currentPhase === 5) {
                                    // Itens do objetivo principal da Fase 5: 3 Elefantes, 3 Le√µes, 3 Aves
                                    if (collectedItem.type === 'elefante') {
                                        this.elefantesColetados++;
                                        console.log(`DEBUG: Elefante coletado! Total: ${this.elefantesColetados}/${this.TOTAL_ELEFANTES}`);
                                    } else if (collectedItem.type === 'leao') {
                                        this.leoesColetados++;
                                        console.log(`DEBUG: Le√£o coletado! Total: ${this.leoesColetados}/${this.TOTAL_LEOES}`);
                                    } else if (collectedItem.type === 'ave') {
                                        this.avesColetadas++;
                                        console.log(`DEBUG: Ave coletada! Total: ${this.avesColetadas}/${this.TOTAL_AVES}`);
                                    }
                                } else if (this.currentPhase === 6) {
                                    // Itens do objetivo principal da Fase 6: 3 Pinturas, 3 Esculturas, 3 F√≥sseis
                                    if (collectedItem.type === 'pintura') {
                                        this.pinturasColetadas++;
                                        console.log(`DEBUG: Pintura coletada! Total: ${this.pinturasColetadas}/${this.TOTAL_PINTURAS}`);
                                    } else if (collectedItem.type === 'escultura') {
                                        this.esculturasColetadas++;
                                        console.log(`DEBUG: Escultura coletada! Total: ${this.esculturasColetadas}/${this.TOTAL_ESCULTURAS}`);
                                    } else if (collectedItem.type === 'fossil') {
                                        this.fosseisColetados++;
                                        console.log(`DEBUG: F√≥ssil coletado! Total: ${this.fosseisColetados}/${this.TOTAL_FOSSEIS}`);
                                    }
                                } else if (this.currentPhase === 7) {
                                    // Itens do objetivo principal da Fase 7: 3 Cestas de Piquenique, 3 Bolas, 3 Brinquedos de Parque
                                    if (collectedItem.type === 'cesta_piquenique') {
                                        this.cestasPiqueniqueColetadas++;
                                        console.log(`DEBUG: Cesta de Piquenique coletada! Total: ${this.cestasPiqueniqueColetadas}/${this.TOTAL_CESTAS_PIQUENIQUE}`);
                                    } else if (collectedItem.type === 'bola' && collectedItem.isObjective) {
                                        this.bolasFase7Coletadas++;
                                        console.log(`DEBUG: Bola (Fase 7) coletada! Total: ${this.bolasFase7Coletadas}/${this.TOTAL_BOLAS_FASE7}`);
                                    } else if (collectedItem.type === 'brinquedo_parque') {
                                        this.brinquedosParqueColetados++;
                                        console.log(`DEBUG: Brinquedo de Parque coletado! Total: ${this.brinquedosParqueColetados}/${this.TOTAL_BRINQUEDOS_PARQUE}`);
                                    }
                                } else if (this.currentPhase === 8) { // Cap√≠tulo 8: Leiturinhas
                                    if (collectedItem.type === 'livro_aventura') {
                                        this.livroAventuraColetados++;
                                        console.log(`DEBUG: Livro de Aventura coletado! Total: ${this.livroAventuraColetados}/${this.TOTAL_LIVRO_AVENTURA}`);
                                    } else if (collectedItem.type === 'livro_animais') {
                                        this.livroAnimaisColetados++;
                                        console.log(`DEBUG: Livro de Animais coletado! Total: ${this.livroAnimaisColetados}/${this.TOTAL_LIVRO_ANIMAIS}`);
                                    } else if (collectedItem.type === 'livro_fabula') {
                                        this.livroFabulaColetados++;
                                        console.log(`DEBUG: Livro de F√°bula coletado! Total: ${this.livroFabulaColetados}/${this.TOTAL_LIVRO_FABULA}`);
                                    }
                                } else if (this.currentPhase === 9) {
                                    if (collectedItem.type === 'lixeira_reciclagem') {
                                        this.lixeiraReciclagemColetados++;
                                        console.log(`DEBUG: Lixeira de Reciclagem coletada! Total: ${this.lixeiraReciclagemColetados}/${this.TOTAL_LIXEIRA_RECICLAGEM}`);
                                    } else if (collectedItem.type === 'garrafa_plastico') {
                                        this.garrafaPlasticoColetados++;
                                        console.log(`DEBUG: Garrafa Pl√°stica coletada! Total: ${this.garrafaPlasticoColetados}/${this.TOTAL_GARRAFA_PLASTICO}`);
                                    } else if (collectedItem.type === 'arvore_muda') {
                                        this.arvoreMudaColetados++;
                                        console.log(`DEBUG: Muda de √Årvore coletada! Total: ${this.arvoreMudaColetados}/${this.TOTAL_ARVORE_MUDA}`);
                                    }
                                } else if (this.currentPhase === 10) {
                                    if (collectedItem.type === 'planta_nativa') {
                                        this.plantaNativaColetados++;
                                        console.log(`DEBUG: Planta Nativa coletada! Total: ${this.plantaNativaColetados}/${this.TOTAL_PLANTAS_NATIVAS}`);
                                    } else if (collectedItem.type === 'animal_selvagem') {
                                        this.animalSelvagemColetados++;
                                        console.log(`DEBUG: Animal Selvagem coletado! Total: ${this.animalSelvagemColetados}/${this.TOTAL_ANIMAIS_SELVAGENS}`);
                                    } else if (collectedItem.type === 'telescopio') {
                                        this.telescopioColetados++;
                                        console.log(`DEBUG: Telesc√≥pio coletado! Total: ${this.telescopioColetados}/${this.TOTAL_TELESCOPIO}`);
                                    }
                                } else if (this.currentPhase === 11) {
                                    if (collectedItem.type === 'pincel') {
                                        this.pincelColetados++;
                                        console.log(`DEBUG: Pincel coletado! Total: ${this.pincelColetados}/${this.TOTAL_PINCEL}`);
                                    } else if (collectedItem.type === 'tinta') {
                                        this.tintaColetados++;
                                        console.log(`DEBUG: Tinta coletada! Total: ${this.tintaColetados}/${this.TOTAL_TINTA}`);
                                    } else if (collectedItem.type === 'argila') {
                                        this.argilaColetados++;
                                        console.log(`DEBUG: Argila coletada! Total: ${this.argilaColetados}/${this.TOTAL_ARGILA}`);
                                    }
                                } else if (this.currentPhase === 12) {
                                    if (collectedItem.type === 'violao') {
                                        this.violaoColetados++;
                                        console.log(`DEBUG: Viol√£o coletado! Total: ${this.violaoColetados}/${this.TOTAL_VIOLAO}`);
                                    } else if (collectedItem.type === 'piano') {
                                        this.pianoColetados++;
                                        console.log(`DEBUG: Piano coletado! Total: ${this.pianoColetados}/${this.TOTAL_PIANO}`);
                                    } else if (collectedItem.type === 'microfone') {
                                        this.microfoneColetados++;
                                        console.log(`DEBUG: Microfone coletado! Total: ${this.microfoneColetados}/${this.TOTAL_MICROFONE}`);
                                    }
                                }
                            } else if (collectedItem.type === 'moeda') {
                                this.tempo += 5;
                                console.log(`DEBUG: Moeda coletada! Tempo +5s. Tempo atual: ${this.tempo}`);
                            }
                            this.atualizarHUD();
                            this.coletando = false;
                            return;
                        }
                    }

                    // Depois verifica itens escolares n√£o colet√°veis (se houver)
                    for (let i = 0; i < this.schoolItems.length; i++) {
                        if (this.schoolItems[i].canBeCollected && this.checkCollision(this.player, this.schoolItems[i])) {
                            const collectedItem = this.schoolItems.splice(i, 1)[0];
                            this.totalAllItemsCollected++; // Incrementa a contagem total
                            this.atualizarHUD();
                            this.coletando = false;
                            return;
                        }
                    }

                    // 2. Intera√ß√£o com o Ba√∫ (apenas na Fase 1)
                    if (this.currentPhase === 1 && this.chest && this.checkCollision(this.player, this.chest)) { // Only check collision if chest exists
                        if (this.pedrasColetadas === this.TOTAL_PEDRAS && this.keysColetadas === this.TOTAL_CHAVES) { // Updated condition
                            this.chest.isOpened = true; // Marca o ba√∫ como aberto
                            this.chest.emoji = 'üóÉÔ∏è'; // Muda o emoji do ba√∫ para aberto
                            console.log("DEBUG: Ba√∫ aberto com sucesso!");
                            this.coletando = false;
                            this.atualizarHUD(); // Atualiza o HUD para mostrar o ba√∫ aberto
                            // A transi√ß√£o de fase √© tratada no setInterval principal, que agora verifica chest.isOpened
                            return;
                        } else { // If trying to open but not all collected
                            const hintMessageDiv = document.getElementById('llmHintMessage');
                            let msg = "Voc√™ precisa coletar todos os itens do objetivo antes de abrir o ba√∫!";
                            if (this.pedrasColetadas < this.TOTAL_PEDRAS) {
                                msg += ` Faltam ${this.TOTAL_PEDRAS - this.pedrasColetadas} pedras.`;
                            }
                            if (this.keysColetadas < this.TOTAL_CHAVES) {
                                msg += ` Faltam ${this.TOTAL_CHAVES - this.keysColetadas} chaves.`;
                            }
                            if (hintMessageDiv) { // Check if element exists before setting innerText
                               hintMessageDiv.innerText = msg;
                               hintMessageDiv.style.display = 'block';
                            }
                            if (this.hintTimeout) clearTimeout(this.hintTimeout);
                            this.hintTimeout = setTimeout(() => {
                                if (hintMessageDiv) { // Check again before hiding
                                    hintMessageDiv.style.display = 'none';
                                }
                            }, 5000);
                            this.coletando = false;
                        }
                    }
                }
            },

            // M√©todo para atualizar a exibi√ß√£o do HUD
            atualizarHUD: function() {
                // Obtenha as refer√™ncias dos elementos do HUD aqui para garantir que s√£o v√°lidas
                const currentVidasDisplayElement = document.getElementById('vidasDisplay');
                const currentHudObjectiveLine1Element = document.getElementById('hudObjectiveLine1');
                const currentHudObjectiveLine2Element = document.getElementById('hudObjectiveLine2');
                const currentTotalAllItemsCollectedDisplayElement = document.getElementById('totalAllItemsCollectedDisplay');
                const currentTempoDisplayElement = document.getElementById('tempo');

                let coracao = "‚ù§Ô∏è".repeat(this.vidas); // Exibe cora√ß√µes com base nas vidas
                let objectiveLine1Content = ''; // Conte√∫do para a linha 1 do objetivo
                let objectiveLine2Content = ''; // Conte√∫do para a linha 2 do objetivo
                let hudTotalCollectedContent = `Total Coletado: ${this.totalAllItemsCollected}`;
                let hudTempoContent = `Tempo: ${this.tempo}s`;

                // Conte√∫do do HUD principal (canto superior esquerdo)
                if (this.currentPhase === 1) {
                    objectiveLine1Content = `üî¥ Pedras: ${this.pedrasColetadas} / ${this.TOTAL_PEDRAS}`;
                    objectiveLine2Content = `üîë Chaves: ${this.keysColetadas} / ${this.TOTAL_CHAVES}<br>üì¶ Ba√∫: ${this.chest && this.chest.isOpened ? '1/1 üîì' : '0/1 üîí'}`;
                } else if (this.currentPhase === 2) {
                    objectiveLine1Content = `üéüÔ∏è Vales Sorvete: ${this.valesSorveteColetados} / ${this.TOTAL_VALES_SORVETE}`;
                    objectiveLine2Content = `üç´üç¶ Sorvetes: ${this.sorvetesObjetivoColetados} / ${this.TOTAL_SORVETES_OBJETIVO}`;
                } else if (this.currentPhase === 3) {
                    objectiveLine1Content = `üèÜ Trof√©us: ${this.trofeusColetados} / ${this.TOTAL_TROFEUS}`;
                    objectiveLine2Content = `‚öΩ Bolas: ${this.bolasColetadas} / ${this.TOTAL_BOLAS_FASE3}<br>ü™Å Pipas: ${this.pipasColetadas} / ${this.TOTAL_PIPAS}`;
                } else if (this.currentPhase === 4) {
                    objectiveLine1Content = `üß™ Tubos Ensaio: ${this.tubosEnsaioColetados} / ${this.TOTAL_TUBOS_ENSAIO}`;
                    objectiveLine2Content = `üß≤ √çm√£s: ${this.imasColetados} / ${this.TOTAL_IMAS}<br>üî¨ Microsc√≥pios: ${this.microscopioColetados} / ${this.TOTAL_MICROSCOPIO}`;
                } else if (this.currentPhase === 5) {
                    objectiveLine1Content = `üêò Elefantes: ${this.elefantesColetados} / ${this.TOTAL_ELEFANTES}`;
                    objectiveLine2Content = `ü¶Å Le√µes: ${this.leoesColetados} / ${this.TOTAL_LEOES}<br>ü¶ú Aves: ${this.avesColetadas} / ${this.TOTAL_AVES}`;
                } else if (this.currentPhase === 6) {
                    objectiveLine1Content = `üé® Pinturas: ${this.pinturasColetadas} / ${this.TOTAL_PINTURAS}`;
                    objectiveLine2Content = `üóø Esculturas: ${this.esculturasColetadas} / ${this.TOTAL_ESCULTURAS}<br>ü¶¥ F√≥sseis: ${this.fosseisColetados} / ${this.TOTAL_FOSSEIS}`;
                } else if (this.currentPhase === 7) {
                    objectiveLine1Content = `üß∫ Cestas Piquenique: ${this.cestasPiqueniqueColetadas} / ${this.TOTAL_CESTAS_PIQUENIQUE}`;
                    objectiveLine2Content = `‚öΩ Bolas: ${this.bolasFase7Coletadas} / ${this.TOTAL_BOLAS_FASE7}<br>üé† Brinquedos: ${this.brinquedosParqueColetados} / ${this.TOTAL_BRINQUEDOS_PARQUE}`;
                } else if (this.currentPhase === 8) {
                    objectiveLine1Content = `üìñ Aventura: ${this.livroAventuraColetados} / ${this.TOTAL_LIVRO_AVENTURA}`;
                    objectiveLine2Content = `ü¶Å Animais: ${this.livroAnimaisColetados} / ${this.TOTAL_LIVRO_ANIMAIS}<br>üìú F√°bula: ${this.livroFabulaColetados} / ${this.TOTAL_LIVRO_FABULA}`;
                } else if (this.currentPhase === 9) {
                    objectiveLine1Content = `‚ôªÔ∏è Reciclagem: ${this.lixeiraReciclagemColetados} / ${this.TOTAL_LIXEIRA_RECICLAGEM}`;
                    objectiveLine2Content = `üß¥ Pl√°stico: ${this.garrafaPlasticoColetados} / ${this.TOTAL_GARRAFA_PLASTICO}<br>üå± √Årvore: ${this.arvoreMudaColetados} / ${this.TOTAL_ARVORE_MUDA}`;
                } else if (this.currentPhase === 10) {
                    objectiveLine1Content = `üåø Plantas: ${this.plantaNativaColetados} / ${this.TOTAL_PLANTAS_NATIVAS}`;
                    objectiveLine2Content = `ü¶Å Animais: ${this.animalSelvagemColetados} / ${this.TOTAL_ANIMAIS_SELVAGENS}<br>üî≠ Telesc√≥pios: ${this.telescopioColetados} / ${this.TOTAL_TELESCOPIO}`;
                } else if (this.currentPhase === 11) {
                    objectiveLine1Content = `üñåÔ∏è Pinc√©is: ${this.pincelColetados} / ${this.TOTAL_PINCEL}`;
                    objectiveLine2Content = `üé® Tintas: ${this.tintaColetados} / ${this.TOTAL_TINTA}<br>üè∫ Argila: ${this.argilaColetados} / ${this.TOTAL_ARGILA}`;
                } else if (this.currentPhase === 12) {
                    objectiveLine1Content = `üé∏ Viol√£o: ${this.violaoColetados} / ${this.TOTAL_VIOLAO}`;
                    objectiveLine2Content = `üéπ Piano: ${this.pianoColetados} / ${this.TOTAL_PIANO}<br>üé§ Microfone: ${this.microfoneColetados} / ${this.TOTAL_MICROFONE}`;
                }

                // Atualiza o texto dos elementos do HUD
                if (currentVidasDisplayElement) currentVidasDisplayElement.innerText = `Vidas: ${coracao}`; // Adiciona o r√≥tulo "Vidas:"
                if (currentTotalAllItemsCollectedDisplayElement) currentTotalAllItemsCollectedDisplayElement.innerText = `Total Coletado: ${this.totalAllItemsCollected}`;
                if (currentTempoDisplayElement) currentTempoDisplayElement.innerText = `Tempo: ${this.tempo}s`; // Adiciona o r√≥tulo "Tempo:"

                if (currentHudObjectiveLine1Element) currentHudObjectiveLine1Element.innerHTML = objectiveLine1Content;
                if (currentHudObjectiveLine2Element) currentHudObjectiveLine2Element.innerHTML = objectiveLine2Content;
            }
        }; // FECHAMENTO CORRETO DO OBJETO 'game'

        // Chama a fun√ß√£o principal de inicializa√ß√£o do jogo quando o DOM estiver completamente carregado
        document.addEventListener('DOMContentLoaded', () => game.initGame());
    </script>
</body>
</html>
